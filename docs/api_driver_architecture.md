# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –∞–≥–µ–Ω—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `reasoning`

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é CLI-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –≤ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π API-—Å–µ—Ä–≤–∏—Å, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å OpenAI, —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≥–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –ø–æ–ª–µ `reasoning`.

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è `LakeView` (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞)

`LakeView` ‚Äî —ç—Ç–æ **—Å–∏—Å—Ç–µ–º–∞ –º–µ—Ç–∞-–∞–Ω–∞–ª–∏–∑–∞**, —Ä–∞–±–æ—Ç–∞—é—â–∞—è "–ø–æ–≤–µ—Ä—Ö" –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∞–≥–µ–Ω—Ç–∞. –ï–µ –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ —à–∞–≥–æ–≤ –≤ —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ.

-   **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
    1.  **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** `LakeView` –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –æ–±—ä–µ–∫—Ç `AgentStep`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –º—ã—Å–ª–∏ LLM –∏ –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
    2.  **–î–≤–æ–π–Ω–æ–π –ø—Ä–æ—Ö–æ–¥ LLM:** `LakeView` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π LLM –¥–ª—è –¥–≤—É—Ö –∑–∞–¥–∞—á:
        -   **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—Ç–∏ (`extract_task_in_step`):** –° –ø–æ–º–æ—â—å—é `EXTRACTOR_PROMPT` –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (`<task>`) –∏ –µ–≥–æ –¥–µ—Ç–∞–ª–∏ (`<details>`). –ù–∞–ø—Ä–∏–º–µ—Ä: `<task>–ê–≥–µ–Ω—Ç –∏–∑—É—á–∞–µ—Ç –∫–æ–¥</task><details>–ê–≥–µ–Ω—Ç –∏—â–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é 'auth' –≤ —Ñ–∞–π–ª–µ 'utils.py'</details>`.
        -   **–ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ (`extract_tag_in_step`):** –° –ø–æ–º–æ—â—å—é `TAGGER_PROMPT` –º–æ–¥–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–≥–æ–≤ –∏–∑ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ (`WRITE_TEST`, `EXAMINE_CODE`, `WRITE_FIX` –∏ —Ç.–¥.), –∫–æ—Ç–æ—Ä—ã–µ –ª—É—á—à–µ –≤—Å–µ–≥–æ –æ–ø–∏—Å—ã–≤–∞—é—Ç –¥–µ–π—Å—Ç–≤–∏–µ.
    3.  **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∞ –≤—ã—Ö–æ–¥–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `LakeViewStep`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ–ø–∏—Å–∞–Ω–∏–µ, –¥–µ—Ç–∞–ª–∏ –∏ –Ω–∞–±–æ—Ä —Ç–µ–≥–æ–≤ —Å —ç–º–æ–¥–∑–∏.

-   **–¶–µ–Ω–Ω–æ—Å—Ç—å:** `LakeView` ‚Äî —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—è `reasoning` –≤ –Ω–∞—à–µ–º API. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é, –ª–µ–≥–∫–æ–≤–µ—Å–Ω—É—é –∏ –ø–æ–Ω—è—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –∞–≥–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∫—Ä–∞—Å–∏–≤–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤ –ª—é–±–æ–º UI.

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ FastAPI —Å–µ—Ä–≤–µ—Ä–∞

–ú—ã —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç.

### –≠–Ω–¥–ø–æ–∏–Ω—Ç: `POST /v1/chat/completions`

-   **–ó–∞–ø—Ä–æ—Å:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞, –∫–∞–∫ —É OpenAI (`messages`, `model`, `stream: true`, –∏ —Ç.–¥.). –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏ –º—ã –¥–æ–±–∞–≤–∏–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä, `session_id`. –ï—Å–ª–∏ `session_id` –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è.
-   **–û—Ç–≤–µ—Ç (–ø–æ—Ç–æ–∫–æ–≤—ã–π, SSE):** –í–æ—Ç –∫–ª—é—á–µ–≤–∞—è —á–∞—Å—Ç—å. –ú—ã –±—É–¥–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç—É –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π, –≥–¥–µ –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ ‚Äî —ç—Ç–æ JSON. –ë—É–¥–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π:

    1.  **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:** –î–ª—è –ø—Ä—è–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç LLM (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –∞–≥–µ–Ω—Ç –∑–∞–¥–∞–µ—Ç —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å).
        ```json
        data: {"choices": [{"delta": {"role": "assistant", "content": "–ö–∞–∫–æ–π —Ñ–∞–π–ª –º–Ω–µ —Å–ª–µ–¥—É–µ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å?"}}]}
        ```

    2.  **–î–∞–Ω–Ω—ã–µ –¥–ª—è `reasoning`:** –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫—É—Ö–Ω–∏" –∞–≥–µ–Ω—Ç–∞. –ü–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

        *   **–ú—ã—Å–ª—å –∞–≥–µ–Ω—Ç–∞:**
            ```json
            data: {"choices": [{"delta": {"reasoning": {"type": "thought", "content": "–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ package.json."}}}]}
            ```
        *   **–í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:**
            ```json
            data: {"choices": [{"delta": {"reasoning": {"type": "tool_call", "tool_name": "file_editor", "args": {"command": "view", "path": "/app/package.json"}}}}]}
            ```
        *   **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã `LakeView` (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —à–∞–≥–∞):**
            ```json
            data: {"choices": [{"delta": {"reasoning": {"type": "lakeview_summary", "task": "–ê–≥–µ–Ω—Ç –∏–∑—É—á–∞–µ—Ç –∫–æ–¥", "details": "–ê–≥–µ–Ω—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ñ–∞–π–ª package.json –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.", "tags": "üëÅÔ∏èEXAMINE_CODE"}}}]}
            ```

-   **Frontend:** UI –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ —Å–ª—É—à–∞–µ—Ç —ç—Ç–æ—Ç –ø–æ—Ç–æ–∫. –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç `delta.content`, –æ–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç. –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç `delta.reasoning`, –æ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞–Ω–µ–ª—å "–•–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", –ø–æ–∫–∞–∑—ã–≤–∞—è –º—ã—Å–ª–∏, –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –∏—Ç–æ–≥–æ–≤–æ–µ —Å–∞–º–º–∞—Ä–∏ —à–∞–≥–∞.

## 3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —á–µ—Ä–µ–∑ API

–¢–≤–æ—è –∏–¥–µ—è "–≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ –¥–∏–∞–ª–æ–≥–∞" ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤–µ—Ä–Ω–∞—è. –≠—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

-   **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏:** –°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏ (`session_id`). –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ —Ç.–¥.

-   **–ü–æ—à–∞–≥–æ–≤—ã–π —Ü–∏–∫–ª:**
    1.  **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.** Frontend –¥–µ–ª–∞–µ—Ç `POST` –Ω–∞ `/v1/chat/completions` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏ `session_id`.
    2.  **–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç –û–î–ò–ù —à–∞–≥ –∞–≥–µ–Ω—Ç–∞.** –û–Ω –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–µ—Å—å —Ü–∏–∫–ª –¥–æ `task_done`. –û–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–∏–Ω `_run_llm_step`.
    3.  **–°–µ—Ä–≤–µ—Ä —Å—Ç—Ä–∏–º–∏—Ç `reasoning`.** –í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–∞, —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ `reasoning` —Å–æ–±—ã—Ç–∏—è (–º—ã—Å–ª–∏, –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤).
    4.  **–®–∞–≥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.** –ê–≥–µ–Ω—Ç –ª–∏–±–æ –≥–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É, –ª–∏–±–æ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    5.  **–°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `LakeView` —Å–∞–º–º–∞—Ä–∏.** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —à–∞–≥–∞, —Å–µ—Ä–≤–µ—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç `LakeView`, –ø–æ–ª—É—á–∞–µ—Ç —Å–∞–º–º–∞—Ä–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –∫–∞–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ `reasoning` —Å–æ–±—ã—Ç–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥–∞.
    6.  **–ü–∞—É–∑–∞.** –¶–∏–∫–ª –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è. –¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –∂–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

-   **"–ê–≤—Ç–æ-–∞–ø–ø—Ä—É–≤" –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:**
    -   –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å". –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –µ–µ, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π `POST` –∑–∞–ø—Ä–æ—Å (–≤–æ–∑–º–æ–∂–Ω–æ, —Å –ø—É—Å—Ç—ã–º `messages`) —Å —Ç–µ–º –∂–µ `session_id`.
    -   –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –∞–≥–µ–Ω—Ç–∞.
    -   –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º "–∞–≤—Ç–æ-–∞–ø–ø—Ä—É–≤", —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è.

**–ò—Ç–æ–≥:**
–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ –≤ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π, –ø–æ—à–∞–≥–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å. –û–Ω–∞ –¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ UI, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, –Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π API-–ø—Ä–æ—Ç–æ–∫–æ–ª. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–≥–µ–Ω—Ç–∞ –æ—Ç –µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∏ –Ω–∞–¥–µ–∂–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –±–∞–∑–µ AI-–∞–≥–µ–Ω—Ç–æ–≤.

---

## 4. –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å "–†–µ–≤—å—é –∏ –ö–æ–º–º–∏—Ç" (Human-in-the-Loop –Ω–∞ —Å—Ç–µ—Ä–æ–∏–¥–∞—Ö)

–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π, –º—ã –≤–≤–æ–¥–∏–º —Ü–∏–∫–ª –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º.

### 4.1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `git_tool` –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º MCP-—Å–µ—Ä–≤–µ—Ä–µ

–¢–µ–∫—É—â–∏–π `git_tool` —É–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å `diff`. –ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ–º—É –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã. –û–Ω –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∫ Git.

**–ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è `git_tool`:**
-   `status`: –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–æ–≤ (–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ, –Ω–æ–≤—ã–µ).
-   `diff`: (—É–∂–µ –µ—Å—Ç—å) –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö.
-   `add`: –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–æ–º–º–∏—Ç–∞ (`git add`).
-   `commit`: –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∞–≥–µ–Ω—Ç–æ–º (`git commit -m "..."`).
-   `restore`: –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ (`git restore .`).

### 4.2. –ü–æ—à–∞–≥–æ–≤—ã–π —Ü–∏–∫–ª "–†–µ–≤—å—é –∏ –ö–æ–º–º–∏—Ç"

1.  **–ê–≥–µ–Ω—Ç –≤–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è:** –ê–≥–µ–Ω—Ç, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `file_editor`, —Å–æ–∑–¥–∞–≤–∞—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö.
2.  **–ê–≥–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–µ–≤—å—é:** –ó–∞–≤–µ—Ä—à–∏–≤ –ª–æ–≥–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫ —Ä–∞–±–æ—Ç—ã, –∞–≥–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ UI —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ –ø–æ–ª–µ `reasoning`, –Ω–∞–ø—Ä–∏–º–µ—Ä: `{"type": "review_request"}`.
3.  **UI –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç `diff`:** –ü–æ–ª—É—á–∏–≤ —ç—Ç–æ—Ç —Å–∏–≥–Ω–∞–ª, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —á–µ—Ä–µ–∑ API –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –∞–≥–µ–Ω—Ç–∞ `diff` –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ê–≥–µ–Ω—Ç, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –≤—ã–∑—ã–≤–∞–µ—Ç `git_tool(command='diff')` –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ. `diff` –∫—Ä–∞—Å–∏–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ, –∫–∞–∫ –≤ Pull Request –Ω–∞ GitHub.
4.  **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ:** –í UI –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ "–û–¥–æ–±—Ä–∏—Ç—å" –∏ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å".
5.  **–°—Ü–µ–Ω–∞—Ä–∏–π "–û–¥–æ–±—Ä–∏—Ç—å":**
    -   UI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É "approve" –Ω–∞ API-—Å–µ—Ä–≤–µ—Ä.
    -   –û–±–ª–∞—á–Ω—ã–π –∞–≥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É. –û–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–æ–º–º–∏—Ç–∞.
    -   –ê–≥–µ–Ω—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `git_tool` –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:
        1.  `git_tool(command='add', path='.')`
        2.  `git_tool(command='commit', message='[AI] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞')`
    -   –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
6.  **–°—Ü–µ–Ω–∞—Ä–∏–π "–û—Ç–∫–ª–æ–Ω–∏—Ç—å":**
    -   UI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É "reject".
    -   –û–±–ª–∞—á–Ω—ã–π –∞–≥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `git_tool(command='restore', path='.')`.
    -   –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–æ–º, –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è. –ê–≥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –æ —Ç–æ–º, —á—Ç–æ –µ–≥–æ —Ä–µ—à–µ–Ω–∏–µ –±—ã–ª–æ –Ω–µ–≤–µ—Ä–Ω—ã–º, –∏ –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥.

–≠—Ç–æ—Ç —Ü–∏–∫–ª —Å—Ç–∞–≤–∏—Ç —á–µ–ª–æ–≤–µ–∫–∞ –Ω–∞ –º–µ—Å—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞, —á—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–¥–æ–º. –ê–≥–µ–Ω—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç, —á–µ–ª–æ–≤–µ–∫ ‚Äî —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç.
